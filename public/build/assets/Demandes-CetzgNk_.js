import{r as o,j as e,a as f,g as p,R as N,b as g}from"./react-select.esm-AIjEkChc.js";import{S as v}from"./Searchbar-Byjzi2je.js";import{N as w}from"./Numpad-Ck20mgBJ.js";const y=({demande:n,setDemandeShow:i})=>{const[l,u]=o.useState(!1),x=()=>{if(n.lignes!==void 0)return n.lignes.map((t,s)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[t.article," (",t.article_reference,")"]}),e.jsx("td",{children:+t.quantite_demande}),e.jsx("td",{children:+t.quantite_livre}),e.jsx("td",{children:+t.quantite_stock})]},t.id+"-"+n.id+"+"+s))},d=t=>{f.post("demande-transfert/"+t+"/annuler").then(s=>{toastr.success("Demande annulée"),i(0)}).catch(s=>{i(0),Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})},m=t=>{f.post("demande-transfert/"+t+"/accepter").then(s=>{toastr.success("Demande acceptée"),i(0)}).catch(s=>{i(0),Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})};return e.jsx(e.Fragment,{children:l?e.jsx("tr",{children:e.jsx("td",{colSpan:100,className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-center",children:[e.jsx("i",{className:"fa fa-arrow-left",onClick:()=>i(0)}),e.jsx("h5",{className:"ms-2 mb-0",children:n.reference})]}),e.jsx("hr",{}),e.jsxs("div",{className:"p-3 bg-body rounded shadow-sm",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:" col-sm-6   ",children:e.jsxs("div",{className:"rounded p-3 bg-white w-100 d-flex align-items-center",children:[e.jsx("div",{className:"rounded bg-soft-info  p-2 d-flex align-items-center justify-content-center",style:{width:"48px"},children:e.jsx("i",{className:"fa fa-cash-register fa-2x"})}),e.jsxs("div",{className:"ms-3 ",children:[e.jsx("span",{className:"font-weight-bolder font-size-sm",children:"Demandé à"}),e.jsx("p",{className:"mb-0 h5 text-black text-capitalize",children:n.magasin_sortie})]})]})}),e.jsx("div",{className:" col-sm-6   ",children:e.jsxs("div",{className:"rounded p-3 bg-white w-100 d-flex align-items-center",children:[e.jsx("div",{className:"rounded bg-soft-warning  p-2 d-flex align-items-center justify-content-center",style:{width:"48px"},children:e.jsx("i",{className:"fa fa-star fa-2x"})}),e.jsxs("div",{className:"ms-3 ",children:[e.jsx("span",{className:"font-weight-bolder font-size-sm",children:"Statut"}),e.jsx("p",{className:"mb-0 h5 text-black text-capitalize",children:n.statut})]})]})})]}),e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("td",{className:"text-white",children:"Produit"}),e.jsx("td",{className:"text-white",children:"Quantité demandée"}),e.jsx("td",{className:"text-white",children:"Quantité livré"}),e.jsx("td",{className:"text-white",children:"Quantité actuelle de stock"})]})}),e.jsx("tbody",{children:x()})]}),n.statut==="Livrée"?e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("button",{onClick:()=>d(n.id),className:"btn btn-soft-danger w-100  font-size-18",children:[" ",e.jsx("i",{className:"fa fa-times me-2"})," Annuler"]}),e.jsxs("button",{onClick:()=>m(n.id),className:"btn btn-soft-success  w-100 font-size-18",children:[" ",e.jsx("i",{className:"fa fa-check me-2"})," Accepter"]})]}):null]})]})})},S=({refresh:n})=>{const[i,l]=o.useState([]),[u,x]=o.useState(!1),[d,m]=o.useState(0),[t,s]=o.useState(!1),r=()=>{x(!0),f.get("mes-demandes").then(a=>{l(a.data),x(!1)})};o.useEffect(()=>{d||r()},[d,n]),o.useEffect(()=>{s(!!d)},[d]);const h=()=>i.length>0?i.map((a,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.reference}),e.jsx("td",{children:a.magasin_sortie}),e.jsx("td",{children:a.statut}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary mx-1",onClick:()=>m(a),children:e.jsx("i",{className:"fa fa-eye"})})})]},"mes-demandes-"+c)):e.jsx("tr",{children:e.jsx("td",{colSpan:"100",className:"text-center",children:"Aucune demande"})});return e.jsx(e.Fragment,{children:t?e.jsx(y,{demande:d,setDemandeShow:m}):e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("th",{className:"text-white",children:"Référence"}),e.jsx("th",{className:"text-white",children:"Demandé à"}),e.jsx("th",{className:"text-white",children:"Status"}),e.jsx("th",{className:"text-white",children:"Action"})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:100,className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"})})}):h()})]})})},k=({demande:n,setDemandeShow:i})=>{o.useState(!1);const[l,u]=o.useState(n),x=()=>{if(l.lignes!==void 0)return l.lignes.map((t,s)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[t.article," (",t.article_reference,")"]}),e.jsx("td",{children:+t.quantite_demande}),e.jsx("td",{children:n.statut==="Nouvelle"?e.jsxs("div",{className:"input-group",children:[e.jsx("button",{className:" btn btn-danger input-group-text",onClick:()=>u({...l,lignes:l.lignes.map(r=>r.id==t.id?{...r,quantite_livre:+r.quantite_livre-1}:r)}),children:"-"}),e.jsx("input",{min:+t.quantite_demande,max:+t.quantite_stock,type:"number",value:+t.quantite_livre,onInput:r=>{u({...l,lignes:l.lignes.map(h=>h.id==t.id?{...h,quantite_livre:+r.target.value}:h)})},className:"form-control"}),e.jsx("button",{className:" btn btn-success input-group-text",onClick:()=>u({...l,lignes:l.lignes.map(r=>r.id==t.id?{...r,quantite_livre:+r.quantite_livre+1}:r)}),children:"+"})]}):+t.quantite_livre}),e.jsx("td",{children:+t.quantite_stock})]},t.id+"-"+n.id+"+"+s))},d=t=>{f.post("demande-transfert/"+t+"/refuser").then(s=>{toastr.success("Demande refusée"),i(0)}).catch(s=>{setIsLoading(!1),populateData(),Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})},m=t=>{f.post("demande-transfert/"+t+"/livrer",l).then(s=>{i(0),toastr.success(s.data)}).catch(s=>{toastr.error("Vuillez ressayer plus tard")})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-center",children:[e.jsx("i",{className:"fa fa-arrow-left",onClick:()=>i(0)}),e.jsx("h5",{className:"ms-2 mb-0",children:n.reference})]}),e.jsx("hr",{}),e.jsxs("div",{className:"bg-body p-3 rounded shadow-sm",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:" col-sm-6   ",children:e.jsxs("div",{className:"rounded p-3 bg-white w-100 d-flex align-items-center",children:[e.jsx("div",{className:"rounded bg-soft-info  p-2 d-flex align-items-center justify-content-center",style:{width:"48px"},children:e.jsx("i",{className:"fa fa-cash-register fa-2x"})}),e.jsxs("div",{className:"ms-3 ",children:[e.jsx("span",{className:"font-weight-bolder font-size-sm",children:"Demandé par"}),e.jsx("p",{className:"mb-0 h5 text-black text-capitalize",children:n.magasin_entree})]})]})}),e.jsx("div",{className:" col-sm-6   ",children:e.jsxs("div",{className:"rounded p-3 bg-white w-100 d-flex align-items-center",children:[e.jsx("div",{className:"rounded bg-soft-warning  p-2 d-flex align-items-center justify-content-center",style:{width:"48px"},children:e.jsx("i",{className:"fa fa-star fa-2x"})}),e.jsxs("div",{className:"ms-3 ",children:[e.jsx("span",{className:"font-weight-bolder font-size-sm",children:"Statut"}),e.jsx("p",{className:"mb-0 h5 text-black text-capitalize",children:n.statut})]})]})})]}),e.jsxs("table",{className:"table table-striped table-bordered border-primary",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("td",{className:"text-white",children:"Produit"}),e.jsx("td",{className:"text-white",children:"Quantité demandée"}),e.jsx("td",{className:"text-white",children:"Quantité livré"}),e.jsx("td",{className:"text-white",children:"Quantité actuelle de stock"})]})}),e.jsx("tbody",{children:x()})]}),n.statut==="Nouvelle"?e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("button",{onClick:()=>d(l.id),className:"btn btn-soft-danger w-100 font-size-18",children:[e.jsx("i",{className:"fa fa-times me-2"})," Refuser"]}),e.jsxs("button",{onClick:()=>m(l.id),className:"btn btn-soft-success w-100  font-size-18",children:[e.jsx("i",{className:"fa fa-check me-2"})," Livrer"]})]}):null]})]})},D=({refresh:n})=>{const[i,l]=o.useState([]),[u,x]=o.useState(!1),[d,m]=o.useState(0),[t,s]=o.useState(!1),r=()=>{x(!0),f.get("demandes-externe").then(c=>{l(c.data),x(!1)})},h=c=>{f.get("demandes-externe-print/"+c).then(b=>{document.getElementById("iframe")&&document.getElementById("iframe").remove();let j=document.createElement("iframe");j.style.display="none",j.id="iframe",j.srcdoc=b.data,document.body.append(j),j.contentWindow.focus(),j.contentWindow.print()})};o.useEffect(()=>{t||r()},[t,n]),o.useEffect(()=>{s(!!d)},[d]);const a=()=>i.length>0?i.map((c,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:c.reference}),e.jsx("td",{children:c.magasin_entree}),e.jsx("td",{children:c.statut}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-sm btn-primary mx-1",onClick:()=>m(c),children:e.jsx("i",{className:"fa fa-eye"})}),c.statut==="Livrée"?e.jsx("button",{onClick:()=>h(c.id),className:"btn btn-sm btn-success mx-1",children:e.jsx("i",{className:"fa fa-print"})}):null]})]},"mes-demandes-"+b)):e.jsx("tr",{children:e.jsx("td",{colSpan:"100",className:"text-center",children:"Aucune demande"})});return e.jsx(e.Fragment,{children:t?e.jsx(k,{demande:d,setDemandeShow:m}):e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("th",{className:"text-white",children:"Référence"}),e.jsx("th",{className:"text-white",children:"Demandé par"}),e.jsx("th",{className:"text-white",children:"Status"}),e.jsx("th",{className:"text-white",children:"Action"})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:100,className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"})})}):a()})]})})},E=({items:n,setItems:i,sendDemande:l,setAddDemande:u})=>{const x={width:"12%",whiteSpace:"nowrap",flexWrap:"nowrap",justifyContent:"center",verticalAlign:"middle"},d=(s,r)=>{let h=n.map(a=>a.id==s?{...a,quantity:r}:a);i(h)},m=s=>{let r=s.target.closest("tr").dataset.id;i(n.filter(h=>h.id!=r))},t=n.length>0?n.map(s=>e.jsxs("tr",{"data-id":s.id,"data-position":s.position,children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[s.name," (",s.reference,")"]}),e.jsx("td",{style:{minWidth:"70px",maxWidth:"100px",whiteSpace:"nowrap",verticalAlign:"middle"},children:e.jsxs("div",{className:"input-group",children:[e.jsx("button",{className:" btn btn-danger input-group-text",onClick:()=>d(s.id,s.quantity-1),children:"-"}),e.jsx("input",{type:"number",value:s.quantity,onChange:r=>d(s.id,r.target.value),className:"form-control"}),e.jsx("button",{className:" btn btn-success input-group-text",onClick:()=>d(s.id,s.quantity+1),children:"+"})]})}),e.jsx("td",{style:x,children:s.stock}),e.jsx("td",{style:x,children:e.jsx("button",{className:"btn btn-soft-danger",onClick:r=>m(r),children:e.jsx("i",{className:"fa fa-trash"})})})]},s.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"text-center",children:["Aucun produit n'est pas ajouté"," "]})});return e.jsxs("div",{className:"card position-absolute",style:{inset:".3rem"},children:[e.jsx("div",{className:"card-body position-relative overflow-y-auto scrollbar",children:e.jsx("div",{className:"col-12 h-100 ",children:e.jsxs("table",{className:"table table-fixed table-striped table-hover table-bordered rounded-top overflow-hidden",id:"products-table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("th",{className:"text-white",children:"Produit"}),e.jsx("th",{className:"text-white",children:"Quantité"}),e.jsx("th",{className:"text-white",children:"Quantité actuelle"}),e.jsx("th",{className:"text-white",children:"Action"})]})}),e.jsx("tbody",{children:t})]})})}),e.jsx("div",{className:"bg-white rounded-bottom p-3 border-light px-4",style:{borderTop:"2px dashed #eee"},children:e.jsxs("div",{className:"row mt-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("button",{className:"btn btn-danger py-3 mx-1 w-100",onClick:()=>{i([]),u(!1)},children:[e.jsx("i",{className:"fa fa-times-circle me-2 h3 mb-0"}),e.jsx("span",{className:"h4 mb-0",children:"Annuler"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("button",{onClick:()=>l(),className:"btn btn-success py-3 mx-1 w-100",children:[e.jsx("i",{className:"fa fa-paper-plane me-2 h3 mb-0"}),e.jsx("span",{className:"h4 mb-0",children:"Demander"})]})})]})})]})},_=({setAddDemande:n})=>{const[i,l]=o.useState(""),[u,x]=o.useState(""),[d,m]=o.useState([]),t=()=>{l("")},s=a=>{a.target.setAttribute("disabled","true"),f.get("articles",{params:{reference:i}}).then(c=>{r(c),a.target.removeAttribute("disabled")}).catch(c=>{toastr.error("Une erreur est survenue"),a.target.removeAttribute("disabled")})},r=a=>{if(a.data.length===1){let c=a.data[0];if(c.quantity=1,c.position=d.length+1,c.reduction=0,d.some(b=>b.id==c.id)){let b=d.map(j=>j.id==c.id?{...j,quantity:j.quantity+1}:j);m(b)}else m([...d,c]);toastr.success("Article ajouté")}else a.data.length>1?toastr.warning("Plusieurs articles trouvés"):toastr.warning("Aucun article trouvé");t()},h=()=>{if(d.length<=0)return toastr.warning("Veuillez d'abord ajouter au moins une ligne"),null;if(u==null||u=="")return toastr.warning("Veuillez sélectionner un magasin de sortie"),null;f.post("demande-transfert",{lignes:d,magasin_sortie:u}).then(a=>{toastr.success(a.data),n(!1)}).catch(a=>{if(a.response.status==422){let c=a.response.data.errors,b="";for(let j in c)b+=`<p class="text-danger">${c[j][0]}</p>`;Swal.fire({icon:"warning",title:"Attention !",html:b,confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})}else Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-7",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-5",children:e.jsxs("div",{className:"input-group flex-nowrap",children:[e.jsx("div",{className:"w-100",children:e.jsx(p,{classNames:{control:()=>"border-light shadow-none",option:a=>a.isFocused?"bg-primary text-white":a.isSelected?"bg-soft-primary text-white":a.isDisabled?"bg-soft-light text-muted":"",singleValue:a=>{a.isFocused}},placeholder:"Magasin de sortie",options:__magasins,value:u,onChange:a=>x(a)})}),e.jsx("button",{"data-bs-toggle":"modal","data-bs-target":"#client-modal",className:"input-group-text btn btn-light",children:"+"})]})}),e.jsx("div",{className:"col-7",children:e.jsx(v,{searchValue:i,setSearchValue:l,validateSearch:s,populateData:r})})]})})})}),e.jsx("div",{className:"col-7 d-flex flex-column",style:{height:"calc(100vh - 16rem)"},children:e.jsx(E,{items:d,setItems:m,sendDemande:h,setAddDemande:n})}),e.jsx("div",{className:"col-5",children:e.jsx(w,{setSearchValue:l,validateSearch:s,clearSearch:t,searchValue:i})})]})};function C(){const[n,i]=o.useState(16),[l,u]=o.useState(!1),[x,d]=o.useState(!1),[m,t]=o.useState(!1),[s,r]=o.useState(!1),[h,a]=o.useState(!1),c=()=>{u(!l),l?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen&&document.documentElement.mozRequestFullScreen()},b=()=>e.jsx("div",{className:"cover-spin",style:{height:"100vh",width:"100vw",zIndex:999999,top:0,left:0,position:"fixed",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0,0,0,0.5)"},dangerouslySetInnerHTML:{__html:__spinner_element_lg}});return o.useEffect(()=>{document.documentElement.style.fontSize=n+"px"},[n]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row m-0",id:"main-row",children:[x?b():"",e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card bg-transparent shadow-none pb-0",children:e.jsxs("div",{className:"card-body pb-1 px-0",children:[e.jsxs("div",{className:"float-end",children:[e.jsx("button",{onClick:()=>i(n+1),className:"btn btn-soft-info mx-1 shadow-sm",children:e.jsx("i",{className:"fa fa-search-plus"})}),e.jsx("button",{onClick:()=>i(n-1),className:"btn btn-soft-purple mx-1 shadow-sm",children:e.jsx("i",{className:"fa fa-search-minus"})}),e.jsx("button",{className:"btn btn-soft-warning mx-1 shadow-sm  ",onClick:()=>c(),children:e.jsx("i",{className:l?"fa fa-compress":"fa fa-expand"})})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx("a",{href:"/point-de-vente",className:"text-primary h3 me-3",children:e.jsx("i",{className:"fa fa-arrow-left"})}),e.jsxs("h3",{children:["Demandes",e.jsxs("span",{className:"h6 ms-1",children:["(",__magasin_ref,")"]})]})]})]})})}),h?e.jsx(_,{setAddDemande:a}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-6 d-flex flex-column",style:{height:"calc(100vh - 10rem)"},children:e.jsxs("div",{className:"card position-absolute",style:{inset:".3rem"},children:[e.jsxs("div",{className:"card-body pb-0 flex-grow-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"m-0",children:"Mes demandes"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-rounded btn-soft-warning me-2",onClick:()=>t(!m),children:e.jsx("i",{className:"fa fa-sync"})}),e.jsx("button",{className:"btn btn-soft-success btn-rounded",onClick:()=>a(!0),children:e.jsx("i",{className:"fa fa-plus"})})]})]}),e.jsx("hr",{})]}),e.jsx("div",{className:"card-body overflow-y-auto scrollbar",children:e.jsx(S,{refresh:m})})]})}),e.jsx("div",{className:"col-6 d-flex flex-column",style:{height:"calc(100vh - 10rem)"},children:e.jsxs("div",{className:"card position-absolute",style:{inset:".3rem"},children:[e.jsxs("div",{className:"card-body pb-0 flex-grow-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"m-0",children:"Demandes externe"}),e.jsx("button",{className:"btn btn-rounded btn-soft-warning",onClick:()=>r(!s),children:e.jsx("i",{className:"fa fa-sync"})})]}),e.jsx("hr",{})]}),e.jsx("div",{className:"card-body overflow-y-auto scrollbar",children:e.jsx(D,{refresh:s})})]})})]})]})})}f.defaults.baseURL=__api_url;f.defaults.headers.common["X-CSRF-TOKEN"]=sessionStorage.getItem("csrf");f.defaults.withCredentials=!0;f.defaults.withXSRFToken=!0;f.defaults.headers.Authorization="Bearer "+sessionStorage.getItem("access_token");N.createRoot(document.getElementById("root")).render(e.jsx(g.StrictMode,{children:e.jsx(C,{})}));
