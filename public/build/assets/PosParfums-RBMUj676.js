import{a as d,j as e,b as x,d as W,R as H}from"./axios-DGPLTa3G.js";import{N as L}from"./Numpad-CmKoywxK.js";import{R as K,A as U,P as X,C as Q,H as G}from"./RapportsPage-BO1HJQn3.js";import{S as J}from"./Searchbar-yD1Qilc2.js";import{D as Y,R as Z}from"./RebutModal-Y7NrsVb-.js";import"./react-select.esm-B9Exsq2_.js";const ee=({items:p,setItems:g,type:v,cashOut:S,resetAll:y,paiement:N,is_prix_editable:C,is_reduction_on:R,setIsLoading:h,onTotalReductionChange:k})=>{const c={width:"12%",whiteSpace:"nowrap",flexWrap:"nowrap",justifyContent:"center",verticalAlign:"middle"},[w,E]=d.useState(!1),o=(s,l)=>{let b=p.map(m=>m.id==s?{...m,quantity:l}:m);g(b),calculateTotalReduction()},r=(s,l)=>{let b=p.map(m=>m.id==s?{...m,reduction:l}:m);g(b),calculateTotalReduction()},_=(s,l)=>{let b=p.map(m=>m.id==s?{...m,prix:l}:m);g(b)},O=s=>{if(!w){h(!0),E(!0);let l=s.target.closest("tr").dataset.id;g(p.filter(b=>b.id!=l)),E(!1),h(!1)}},[B,T]=d.useState(0),q=s=>{const l=s.target.value;T(l),k(l)},A=p.length>0?p.map(s=>e.jsxs("tr",{"data-id":s.id,"data-position":s.position,children:[e.jsxs("td",{className:"align-middle",children:[s.name," (",s.reference," - ",e.jsxs("span",{className:"text-muted fw-bold",children:["Stock: ",s.stock]}),")"]}),e.jsx("td",{style:{minWidth:"70px",maxWidth:"100px",whiteSpace:"nowrap",verticalAlign:"middle"},children:e.jsxs("div",{className:"input-group",children:[e.jsx("button",{className:" btn btn-danger input-group-text",onClick:()=>o(s.id,s.quantity-1),children:"-"}),e.jsx("input",{type:"number",value:s.quantity,onChange:l=>o(s.id,l.target.value),className:"form-control"}),e.jsx("button",{className:" btn btn-success input-group-text",onClick:()=>o(s.id,s.quantity+1),children:"+"})]})}),C?e.jsx("td",{style:{minWidth:"70px",maxWidth:"100px",whiteSpace:"nowrap",verticalAlign:"middle"},children:e.jsxs("div",{className:"input-group",style:{display:"flex",alignItems:"center",minWidth:"150px"},children:[e.jsx("input",{type:"number",value:s.prix,onChange:l=>_(s.id,l.target.value),className:"form-control",style:{flex:1}}),e.jsx("span",{className:"input-group-text",style:{marginLeft:"5px"},children:"MAD"})]})}):e.jsxs("td",{style:c,children:[s.prix," MAD"]}),R?e.jsx("td",{style:{minWidth:"70px",maxWidth:"100px",whiteSpace:"nowrap",verticalAlign:"middle"},children:e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"number",value:s.reduction,onChange:l=>r(s.id,l.target.value),className:"form-control"}),e.jsx("span",{className:"input-group-text",children:"%"})]})}):null,e.jsxs("td",{style:c,children:[(s.quantity*s.prix*(1-s.reduction/100)).toFixed(2),"MAD"]}),e.jsx("td",{style:c,children:e.jsx("button",{className:"btn btn-soft-danger",onClick:l=>O(l),children:e.jsx("i",{className:"fa fa-trash"})})})]},s.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"text-center",children:["Aucun produit n'est pas ajouté"," "]})});return e.jsxs("div",{className:"card position-absolute",style:{inset:".3rem"},children:[e.jsx("div",{className:"card-body position-relative overflow-y-auto scrollbar",children:e.jsx("div",{className:"col-12 h-100 ",children:e.jsxs("table",{className:"table table-fixed table-striped table-hover table-bordered rounded-top overflow-hidden",id:"products-table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:v==="bc"?"bg-primary":"bg-success",children:[e.jsx("th",{className:"text-white",children:"Produit"}),e.jsx("th",{className:"text-white",children:"Quantite"}),e.jsx("th",{className:"text-white",children:"Prix"}),R?e.jsx("th",{className:"text-white",children:"Reduction"}):null,e.jsx("th",{className:"text-white",children:"Total"}),e.jsx("th",{className:"text-white",children:"Action"})]})}),e.jsx("tbody",{children:A})]})})}),e.jsxs("div",{className:"bg-white rounded-bottom p-3 border-light px-4",style:{borderTop:"2px dashed #eee"},children:[e.jsx("div",{className:"row my-3",children:e.jsxs("div",{className:"col-12 d-flex justify-content-between align-items-center gap-5",children:[e.jsx("h4",{className:"mr-3 text-nowrap",children:"Total Reduction :"})," ",e.jsxs("div",{className:"input-group",style:{minWidth:"150px"},children:[e.jsx("input",{type:"number",value:B,onChange:q,className:"form-control"}),e.jsx("span",{className:"input-group-text",children:"%"})]})]})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12 my-1 d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"m-0",children:"Montant total :"}),e.jsxs("h4",{className:"m-0",children:[(N.i_montant-N.i_montant*(isNaN(parseFloat(B))?0:parseFloat(B))/100).toLocaleString(void 0,{minimumFractionDigits:2}),e.jsx("span",{className:"ms-2",children:"MAD"})]})]}),e.jsxs("div",{className:"col-12 my-1 d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"m-0",children:"Nombre d'articles :"}),e.jsx("h4",{className:"m-0",children:p.reduce((s,l)=>s+l.quantity,0)})]})]}),e.jsxs("div",{className:"row mt-3 g-3 justify-content-end",children:[e.jsx("div",{className:"col-6",children:e.jsxs("button",{className:"btn btn-danger py-3 mx-1 w-100",onClick:()=>y(),children:[e.jsx("i",{className:"fa fa-times-circle me-2 h3 mb-0"}),e.jsx("span",{className:"h4 mb-0",children:"Annuler"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("button",{onClick:()=>S(),className:"btn btn-success py-3 mx-1 w-100",children:[e.jsx("i",{className:"fa fa-coins me-2 h3 mb-0"}),e.jsx("span",{className:"h4 mb-0",children:"Espèces"})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("button",{className:"btn btn-warning py-3 mx-1 w-100",onClick:()=>S(!0),children:[e.jsx("i",{className:"fa fa-wallet me-2 h3 mb-0"}),e.jsx("span",{className:"h4 mb-0",children:"Credit"})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("button",{className:"btn btn-info py-3 mx-1 w-100","data-bs-target":"#paiement-modal","data-bs-toggle":"modal",children:[e.jsx("i",{className:"fa fa-cash-register me-2 h3 mb-0"}),e.jsx("span",{className:"h4 mb-0",children:"Autre"})]})})]})]})]})};function te(){const[p,g]=d.useState(""),[v,S]=d.useState(16),[y,N]=d.useState(__default_client),[C,R]=d.useState(!1),[h,k]=d.useState("bc"),[c,w]=d.useState([]),[E,o]=d.useState(!1),[r,_]=d.useState({i_date_paiement:"",i_montant:"",i_note:"",i_method_key:"",i_reference:"",i_date:"",i_compte_id:"",vente_id:null}),[O,B]=d.useState({nom:"",category_id:"",benificiaire:"",montant:0,description:"",session_id:__session_id}),T=()=>{g("")},q=t=>{t.target.setAttribute("disabled","true"),x.get("articles",{params:{reference:p}}).then(n=>{A(n),t.target.removeAttribute("disabled")}).catch(n=>{toastr.error("Une erreur est survenue"),t.target.removeAttribute("disabled")})},A=t=>{if(t.data.length===1){let n=t.data[0];if(n.quantity=1,n.position=c.length+1,n.reduction=0,c.some(i=>i.id==n.id)){let i=c.map(a=>a.id==n.id?{...a,quantity:a.quantity+1}:a);w(i)}else w([...c,n]);toastr.success("Article ajouté")}else t.data.length>1?toastr.warning("Plusieurs articles trouvés"):toastr.warning("Aucun article trouvé");T()},s=()=>{R(!C),C?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen&&document.documentElement.mozRequestFullScreen()};function l(t){document.getElementById("iframe")&&document.getElementById("iframe").remove();let n=document.createElement("iframe");n.style.display="none",n.id="iframe",n.srcdoc=t,document.body.append(n),n.contentWindow.focus(),n.contentWindow.print()}const b=()=>{Swal.fire({title:"Est-vous sûr?",text:"Vous voulez vraiment arreter la session !",icon:"warning",showCancelButton:!0,confirmButtonText:"Oui, Arreter !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-soft-danger mx-2",cancelButton:"btn btn-soft-secondary mx-2"},didOpen:()=>{$(".btn").blur()},preConfirm:async()=>{Swal.showLoading(),o(!0);try{const[t]=await Promise.all([x.delete("pos-session/terminer",{headers:{"X-CSRF-TOKEN":__csrf_token}})]);return t}catch(t){o(!1);let n="Une erreur s'est produite lors de la demande.";throw t.status===404&&(n="La ressource n'a pas été trouvée."),Swal.fire({title:"Erreur",text:n,icon:"error",buttonsStyling:!1,confirmButtonText:"OK",customClass:{confirmButton:"btn btn-soft-danger mx-2"}}),t}}}).then(t=>{t.isConfirmed&&(t.value?Swal.fire({title:"Succès",text:"Session est terminée.",icon:"success",buttonsStyling:!1,confirmButtonText:"OK",customClass:{confirmButton:"btn btn-soft-success mx-2"}}).then(n=>{window.location.reload()}):(o(!1),Swal.fire({title:"Erreur",text:"Une erreur s'est produite lors de la demande.",icon:"error",buttonsStyling:!1,confirmButtonText:"OK",customClass:{confirmButton:"btn btn-soft-danger mx-2"}})))})},m=()=>{o(!0),x.get("pos-session/cloture").then(t=>{o(!1),Swal.fire({title:"Clôture de session",html:"<div class='bg-body p-3' >"+t.data+"</div>",showCancelButton:!0,confirmButtonText:"Imprimer",cancelButtonText:"Annuler",buttonsStyling:!1,customClass:{confirmButton:"btn btn-soft-success mx-2",cancelButton:"btn btn-soft-secondary mx-2"},didOpen:()=>{$(".btn").blur()}}).then(n=>{n.isConfirmed&&(n.value?l(t.data):Swal.fire({title:"Erreur",text:"Une erreur s'est produite lors de la demande.",icon:"error",buttonsStyling:!1,confirmButtonText:"OK",customClass:{confirmButton:"btn btn-soft-danger mx-2"}}))})})},P=(t=!1)=>{if(y==null){toastr.warning("Vuillez inserer un client !");return}let n={lignes:c,client:y.value,type:h,exercice:__exercice,session_id:__session_id,total_red:I};t&&(n.credit=!0),o(!0),x.post("ventes",n).then(i=>{o(!1),toastr.success(i.data.message),j(),i.data.template!=null&&l(i.data.template)}).catch(i=>{if(o(!1),i.response&&i.response.status==422)if(i.response.data&&i.response.data.error)Swal.fire({icon:"warning",title:"Attention !",text:i.response.data.error,confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}});else if(i.response.data&&i.response.data.errors){let a=i.response.data.errors,u="";for(let f in a)u+=`<p class="text-danger">${a[f][0]}</p>`;Swal.fire({icon:"warning",title:"Attention !",html:u,confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})}else Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}});else Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})},z=()=>{if(y==null){toastr.warning("Vuillez inserer un client !");return}_({...r,i_date_paiement:document.querySelector("#date_paiement").value,i_date:document.querySelector("#date_prevu").value});const t=(Math.round(c.reduce((i,a)=>i+a.prix*a.quantity,0)*100)/100).toFixed(2),n=parseFloat(r.i_montant)<parseFloat(t);if(r.vente_id){let i={vente_id:r.vente_id,paiement:{...r,i_date_paiement:document.querySelector("#date_paiement").value,i_date:document.querySelector("#date_prevu").value,i_compte_id:r.i_compte_id.value,i_method_key:r.i_method_key.value},session_id:__session_id};o(!0),x.post("ventes-ajouter-paiement",i).then(a=>{o(!1),$("#paiement-modal").modal("hide");const u=(parseFloat(t)-parseFloat(r.i_montant)).toFixed(2);parseFloat(u)>0?Swal.fire({icon:"success",title:"Paiement partiel enregistré !",html:`${a.data.message}<br><br>Voulez-vous ajouter un autre paiement à cette vente?`,showCancelButton:!0,confirmButtonText:"Oui, ajouter un paiement",cancelButtonText:"Non, terminer",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-success mx-2",cancelButton:"btn btn-lg btn-soft-secondary mx-2"}}).then(f=>{f.isConfirmed?(_({...r,i_montant:u,i_note:"",i_method_key:"",i_reference:"",i_date:"",i_compte_id:""}),setTimeout(()=>{$("#paiement-modal").modal("show")},500)):(j(),a.data.template!=null&&l(a.data.template))}):(Swal.fire({icon:"success",title:"Paiement complet !",html:a.data.message,confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-success mx-2"}}),j(),a.data.template!=null&&l(a.data.template))}).catch(a=>{if(o(!1),a.response&&a.response.status==422){let u=a.response.data.errors,f="";for(let F in u)f+=`<p class="text-white">${u[F][0]}</p>`;toastr.warning(f)}else toastr.danger("Vuillez ressayer plus tard")})}else{let i={lignes:c,client:y.value,type:h,exercice:__exercice,paiement:{...r,i_date_paiement:document.querySelector("#date_paiement").value,i_date:document.querySelector("#date_prevu").value,i_compte_id:r.i_compte_id.value,i_method_key:r.i_method_key.value},session_id:__session_id};o(!0),x.post("ventes-paiement",i).then(a=>{if(o(!1),n){$("#paiement-modal").modal("hide");const u=a.data.vente_id,f=(parseFloat(t)-parseFloat(r.i_montant)).toFixed(2);Swal.fire({icon:"success",title:"Paiement partiel enregistré !",html:`${a.data.message}<br><br>Voulez-vous ajouter un autre paiement à cette vente?`,showCancelButton:!0,confirmButtonText:"Oui, ajouter un paiement",cancelButtonText:"Non, terminer",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-success mx-2",cancelButton:"btn btn-lg btn-soft-secondary mx-2"}}).then(F=>{F.isConfirmed?(_({i_date_paiement:"",i_montant:f,i_note:"",i_method_key:"",i_reference:"",i_date:"",i_compte_id:"",vente_id:u}),setTimeout(()=>{$("#paiement-modal").modal("show")},500)):(j(),a.data.template!=null&&l(a.data.template))})}else toastr.success(a.data.message),j(),$("#paiement-modal").modal("hide"),a.data.template!=null&&l(a.data.template)}).catch(a=>{if(o(!1),a.response&&a.response.status==422){let u=a.response.data.errors,f="";for(let F in u)f+=`<p class="text-white">${u[F][0]}</p>`;toastr.warning(f)}else toastr.danger("Vuillez ressayer plus tard")})}},j=()=>{w([]),N(__default_client),k("bc"),_({i_date_paiement:"",i_montant:"",i_note:"",i_method_key:"",i_date:"",i_reference:"",i_compte_id:"",vente_id:null})},D=()=>e.jsx("div",{className:"cover-spin",style:{height:"100vh",width:"100vw",zIndex:999999,top:0,left:0,position:"fixed",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0,0,0,0.5)"},dangerouslySetInnerHTML:{__html:__spinner_element_lg}});d.useEffect(()=>{document.documentElement.style.fontSize=v+"px"},[v]),d.useEffect(()=>{_({...r,i_montant:(Math.round(c.reduce((t,n)=>t+n.prix*n.quantity,0)*100)/100).toFixed(2),i_date_paiement:document.querySelector("#date_paiement").value,i_date:document.querySelector("#date_prevu").value})},[c]);const[I,M]=d.useState(0),V=t=>{M(t)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row m-0",id:"main-row",children:[E?D():"",e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card bg-transparent shadow-none pb-0",children:e.jsxs("div",{className:"card-body pb-1 px-0",children:[e.jsxs("div",{className:"float-end",children:[e.jsx("button",{onClick:()=>m(),className:"btn btn-info mx-1",children:e.jsx("i",{className:"fa fa-file-contract "})}),(__rapport_ac_enabled==1||__rapport_as_enabled==1)&&e.jsx(K,{}),__is_depenses&&e.jsx("button",{className:"btn btn-soft-danger mx-1","data-bs-target":"#depense-modal","data-bs-toggle":"modal",children:e.jsx("i",{className:"fa fa-money-bill-alt ",children:" Dépenses"})}),__is_rebut==1&&e.jsxs("button",{className:"btn btn-soft-purple mx-1","data-bs-target":"#rebut-modal","data-bs-toggle":"modal",children:[e.jsx("i",{className:"mdi mdi-delete-variant "})," Rebut"]}),__is_demandes&&e.jsxs("a",{href:"/point-de-vente/demandes",className:"btn btn-soft-success mx-1",children:[e.jsx("i",{className:"fas fa-external-link-alt me-2"}),"Demandes"]}),__is_historique&&e.jsxs("button",{className:"btn btn-primary mx-1 shadow-sm",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasExample",children:[e.jsx("i",{className:"fa fa-history ","data-bs-template":'<div class="tooltip mb-1 rounded " role="tooltip"><div class="tooltip-inner bg-primary font-size-10"></div></div>',"data-bs-toggle":"tooltip","data-bs-custom-class":"primary-tooltip","data-bs-placement":"top","data-bs-original-title":"Historique"})," Historique"]}),e.jsx("button",{onClick:()=>S(v+1),className:"btn btn-soft-info mx-1 shadow-sm",children:e.jsx("i",{className:"fa fa-search-plus"})}),e.jsx("button",{onClick:()=>S(v-1),className:"btn btn-soft-purple mx-1 shadow-sm",children:e.jsx("i",{className:"fa fa-search-minus"})}),e.jsx("button",{className:"btn btn-soft-warning mx-1 shadow-sm  ",onClick:()=>s(),children:e.jsx("i",{className:C?"fa fa-compress":"fa fa-expand"})}),e.jsx("button",{onClick:()=>b(),className:"btn btn-danger mx-1 shadow-sm",children:e.jsx("i",{className:"fa fa-power-off"})})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx("a",{href:"/",className:"text-primary h3 me-3",children:e.jsx("i",{className:"fa fa-arrow-left"})}),e.jsxs("h3",{children:["Point de vente",e.jsxs("span",{className:"h6 ms-1",children:["(",__magasin_ref,")"]})]})]})]})})}),e.jsx("div",{className:"col-7",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-5",children:e.jsxs("div",{className:"input-group flex-nowrap",children:[e.jsx("div",{className:"w-100",children:e.jsx(U,{classNames:{control:()=>"border-light shadow-none",option:t=>t.isFocused?"bg-primary text-white":t.isSelected?"bg-soft-primary text-white":t.isDisabled?"bg-soft-light text-muted":"",singleValue:t=>{t.isFocused}},cache:!1,defaultValue:__default_client,value:y,onChange:t=>N(t),loadOptions:async t=>(await x.get("clients-liste",{params:{search:t}})).data.map(i=>({value:i.id,label:i.nom}))})}),e.jsx("button",{"data-bs-toggle":"modal","data-bs-target":"#client-modal",className:"input-group-text btn btn-light",children:"+"})]})}),e.jsx("div",{className:"col-7",children:e.jsx(J,{searchValue:p,setSearchValue:g,validateSearch:q,populateData:A})})]})})})}),e.jsx("div",{className:"col-5",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-6",children:e.jsx("button",{className:h=="bc"?"btn btn-block w-100 btn-primary border-primary ":"btn btn-block w-100 border-primary text-primary",onClick:()=>{j(),k("bc")},style:{border:h=="bc"?"solid 3px":"dashed 3px",transition:"all .s ease-in-out"},children:"Vente"})}),e.jsx("div",{className:"col-6",children:e.jsx("button",{className:h=="br"?"btn btn-block w-100 btn-success border-success":"btn btn-block w-100 border-success text-success",onClick:()=>{j(),k("br")},style:{border:h=="br"?"solid 3px":"dashed 3px"},children:"Retour"})})]})})})}),e.jsx("div",{className:"col-7 d-flex flex-column",style:{height:"calc(100vh - 16rem)"},children:e.jsx(ee,{items:c,type:h,cashOut:P,setItems:w,resetAll:j,paiement:r,setIsLoading:o,onTotalReductionChange:V})}),e.jsx("div",{className:"col-5",children:e.jsx("div",{className:"row",children:e.jsx(L,{searchValue:p,setSearchValue:g,clearSearch:T,validateSearch:q})})})]}),e.jsx(X,{paiement:r,payer:z,setPaiement:_}),e.jsx(Q,{setClient:N,setIsLoading:o}),e.jsx(G,{reduction:!1}),e.jsx(Y,{depense:O,setDepense:B}),e.jsx(Z,{})]})}x.defaults.baseURL=__api_url;x.defaults.headers.common["X-CSRF-TOKEN"]=sessionStorage.getItem("csrf");x.defaults.withCredentials=!0;x.defaults.withXSRFToken=!0;x.defaults.headers.Authorization="Bearer "+sessionStorage.getItem("access_token");W.createRoot(document.getElementById("root")).render(e.jsx(H.StrictMode,{children:e.jsx(te,{})}));
