import{a as o,j as e,e as f,h as p,c as N}from"./index-CotjMrcd.js";import{S as g}from"./Searchbar-CMVfAT-F.js";import{e as v}from"./react-select.esm-DLNcz9Oi.js";import{N as w}from"./Numpad-GEOvMQiS.js";const y=({demande:a,setDemandeShow:c})=>{const[x,h]=o.useState(!1),i=()=>{if(a.lignes!==void 0)return a.lignes.map((d,t)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[d.article," (",d.article_reference,")"]}),e.jsx("td",{children:+d.quantite_demande}),e.jsx("td",{children:+d.quantite_livre}),e.jsx("td",{children:+d.quantite_stock})]},d.id+"-"+a.id+"+"+t))},l=d=>{f.post("demande-transfert/"+d+"/annuler").then(t=>{toastr.success("Demande annulée"),c(0)}).catch(t=>{c(0),Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})},u=d=>{f.post("demande-transfert/"+d+"/accepter").then(t=>{toastr.success("Demande acceptée"),c(0)}).catch(t=>{c(0),Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})};return e.jsx(e.Fragment,{children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:100,className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-center",children:[e.jsx("i",{className:"fa fa-arrow-left",onClick:()=>c(0)}),e.jsx("h5",{className:"ms-2 mb-0",children:a.reference})]}),e.jsx("hr",{}),e.jsxs("div",{className:"p-3 bg-body rounded shadow-sm",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:" col-sm-6   ",children:e.jsxs("div",{className:"rounded p-3 bg-white w-100 d-flex align-items-center",children:[e.jsx("div",{className:"rounded bg-soft-info  p-2 d-flex align-items-center justify-content-center",style:{width:"48px"},children:e.jsx("i",{className:"fa fa-cash-register fa-2x"})}),e.jsxs("div",{className:"ms-3 ",children:[e.jsx("span",{className:"font-weight-bolder font-size-sm",children:"Demandé à"}),e.jsx("p",{className:"mb-0 h5 text-black text-capitalize",children:a.magasin_sortie})]})]})}),e.jsx("div",{className:" col-sm-6   ",children:e.jsxs("div",{className:"rounded p-3 bg-white w-100 d-flex align-items-center",children:[e.jsx("div",{className:"rounded bg-soft-warning  p-2 d-flex align-items-center justify-content-center",style:{width:"48px"},children:e.jsx("i",{className:"fa fa-star fa-2x"})}),e.jsxs("div",{className:"ms-3 ",children:[e.jsx("span",{className:"font-weight-bolder font-size-sm",children:"Statut"}),e.jsx("p",{className:"mb-0 h5 text-black text-capitalize",children:a.statut})]})]})})]}),e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("td",{className:"text-white",children:"Produit"}),e.jsx("td",{className:"text-white",children:"Quantité demandée"}),e.jsx("td",{className:"text-white",children:"Quantité livré"}),e.jsx("td",{className:"text-white",children:"Quantité actuelle de stock"})]})}),e.jsx("tbody",{children:i()})]}),a.statut==="Livrée"?e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("button",{onClick:()=>l(a.id),className:"btn btn-soft-danger w-100  font-size-18",children:[" ",e.jsx("i",{className:"fa fa-times me-2"})," Annuler"]}),e.jsxs("button",{onClick:()=>u(a.id),className:"btn btn-soft-success  w-100 font-size-18",children:[" ",e.jsx("i",{className:"fa fa-check me-2"})," Accepter"]})]}):null]})]})})},S=({refresh:a})=>{const[c,x]=o.useState([]),[h,i]=o.useState(!1),[l,u]=o.useState(0),[d,t]=o.useState(!1),n=()=>{i(!0),f.get("mes-demandes").then(s=>{x(s.data),i(!1)})};o.useEffect(()=>{l||n()},[l,a]),o.useEffect(()=>{t(!!l)},[l]);const m=()=>c.length>0?c.map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.reference}),e.jsx("td",{children:s.magasin_sortie}),e.jsx("td",{children:s.statut}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary mx-1",onClick:()=>u(s),children:e.jsx("i",{className:"fa fa-eye"})})})]},"mes-demandes-"+r)):e.jsx("tr",{children:e.jsx("td",{colSpan:"100",className:"text-center",children:"Aucune demande"})});return e.jsx(e.Fragment,{children:d?e.jsx(y,{demande:l,setDemandeShow:u}):e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("th",{className:"text-white",children:"Référence"}),e.jsx("th",{className:"text-white",children:"Demandé à"}),e.jsx("th",{className:"text-white",children:"Status"}),e.jsx("th",{className:"text-white",children:"Action"})]})}),e.jsx("tbody",{children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:100,className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"})})}):m()})]})})},k=({demande:a,setDemandeShow:c})=>{const[x,h]=o.useState(!1),[i,l]=o.useState(a),u=()=>{if(i.lignes!==void 0)return i.lignes.map((n,m)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[n.article," (",n.article_reference,")"]}),e.jsx("td",{children:+n.quantite_demande}),e.jsx("td",{children:a.statut==="Nouvelle"?e.jsxs("div",{className:"input-group",children:[e.jsx("button",{className:" btn btn-danger input-group-text",onClick:()=>l({...i,lignes:i.lignes.map(s=>s.id==n.id?{...s,quantite_livre:+s.quantite_livre-1}:s)}),children:"-"}),e.jsx("input",{min:+n.quantite_demande,max:+n.quantite_stock,type:"number",value:+n.quantite_livre,onInput:s=>{l({...i,lignes:i.lignes.map(r=>r.id==n.id?{...r,quantite_livre:+s.target.value}:r)})},className:"form-control"}),e.jsx("button",{className:" btn btn-success input-group-text",onClick:()=>l({...i,lignes:i.lignes.map(s=>s.id==n.id?{...s,quantite_livre:+s.quantite_livre+1}:s)}),children:"+"})]}):+n.quantite_livre}),e.jsx("td",{children:+n.quantite_stock})]},n.id+"-"+a.id+"+"+m))},d=n=>{f.post("demande-transfert/"+n+"/refuser").then(m=>{toastr.success("Demande refusée"),c(0)}).catch(m=>{setIsLoading(!1),populateData(),Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})},t=n=>{f.post("demande-transfert/"+n+"/livrer",i).then(m=>{c(0),toastr.success(m.data)}).catch(m=>{toastr.error("Vuillez ressayer plus tard")})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-center",children:[e.jsx("i",{className:"fa fa-arrow-left",onClick:()=>c(0)}),e.jsx("h5",{className:"ms-2 mb-0",children:a.reference})]}),e.jsx("hr",{}),e.jsxs("div",{className:"bg-body p-3 rounded shadow-sm",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:" col-sm-6   ",children:e.jsxs("div",{className:"rounded p-3 bg-white w-100 d-flex align-items-center",children:[e.jsx("div",{className:"rounded bg-soft-info  p-2 d-flex align-items-center justify-content-center",style:{width:"48px"},children:e.jsx("i",{className:"fa fa-cash-register fa-2x"})}),e.jsxs("div",{className:"ms-3 ",children:[e.jsx("span",{className:"font-weight-bolder font-size-sm",children:"Demandé par"}),e.jsx("p",{className:"mb-0 h5 text-black text-capitalize",children:a.magasin_entree})]})]})}),e.jsx("div",{className:" col-sm-6   ",children:e.jsxs("div",{className:"rounded p-3 bg-white w-100 d-flex align-items-center",children:[e.jsx("div",{className:"rounded bg-soft-warning  p-2 d-flex align-items-center justify-content-center",style:{width:"48px"},children:e.jsx("i",{className:"fa fa-star fa-2x"})}),e.jsxs("div",{className:"ms-3 ",children:[e.jsx("span",{className:"font-weight-bolder font-size-sm",children:"Statut"}),e.jsx("p",{className:"mb-0 h5 text-black text-capitalize",children:a.statut})]})]})})]}),e.jsxs("table",{className:"table table-striped table-bordered border-primary",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("td",{className:"text-white",children:"Produit"}),e.jsx("td",{className:"text-white",children:"Quantité demandée"}),e.jsx("td",{className:"text-white",children:"Quantité livré"}),e.jsx("td",{className:"text-white",children:"Quantité actuelle de stock"})]})}),e.jsx("tbody",{children:u()})]}),a.statut==="Nouvelle"?e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("button",{onClick:()=>d(i.id),className:"btn btn-soft-danger w-100 font-size-18",children:[e.jsx("i",{className:"fa fa-times me-2"})," Refuser"]}),e.jsxs("button",{onClick:()=>t(i.id),className:"btn btn-soft-success w-100  font-size-18",children:[e.jsx("i",{className:"fa fa-check me-2"})," Livrer"]})]}):null]})]})},D=({refresh:a})=>{const[c,x]=o.useState([]),[h,i]=o.useState(!1),[l,u]=o.useState(0),[d,t]=o.useState(!1),n=()=>{i(!0),f.get("demandes-externe").then(r=>{x(r.data),i(!1)})},m=r=>{f.get("demandes-externe-print/"+r).then(b=>{document.getElementById("iframe")&&document.getElementById("iframe").remove();let j=document.createElement("iframe");j.style.display="none",j.id="iframe",j.srcdoc=b.data,document.body.append(j),j.contentWindow.focus(),j.contentWindow.print()})};o.useEffect(()=>{d||n()},[d,a]),o.useEffect(()=>{t(!!l)},[l]);const s=()=>c.length>0?c.map((r,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:r.reference}),e.jsx("td",{children:r.magasin_entree}),e.jsx("td",{children:r.statut}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-sm btn-primary mx-1",onClick:()=>setSelectedDemaande(r),children:e.jsx("i",{className:"fa fa-eye"})}),r.statut==="Livrée"?e.jsx("button",{onClick:()=>m(r.id),className:"btn btn-sm btn-success mx-1",children:e.jsx("i",{className:"fa fa-print"})}):null]})]},"mes-demandes-"+b)):e.jsx("tr",{children:e.jsx("td",{colSpan:"100",className:"text-center",children:"Aucune demande"})});return e.jsx(e.Fragment,{children:d?e.jsx(k,{demande:l,setDemandeShow:u}):e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("th",{className:"text-white",children:"Référence"}),e.jsx("th",{className:"text-white",children:"Demandé par"}),e.jsx("th",{className:"text-white",children:"Status"}),e.jsx("th",{className:"text-white",children:"Action"})]})}),e.jsx("tbody",{children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:100,className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"})})}):s()})]})})},E=({items:a,setItems:c,sendDemande:x,setAddDemande:h})=>{const i={width:"12%",whiteSpace:"nowrap",flexWrap:"nowrap",justifyContent:"center",verticalAlign:"middle"},l=(t,n)=>{let m=a.map(s=>s.id==t?{...s,quantity:n}:s);c(m)},u=t=>{let n=t.target.closest("tr").dataset.id;c(a.filter(m=>m.id!=n))},d=a.length>0?a.map(t=>e.jsxs("tr",{"data-id":t.id,"data-position":t.position,children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[t.name," (",t.reference,")"]}),e.jsx("td",{style:{minWidth:"70px",maxWidth:"100px",whiteSpace:"nowrap",verticalAlign:"middle"},children:e.jsxs("div",{className:"input-group",children:[e.jsx("button",{className:" btn btn-danger input-group-text",onClick:()=>l(t.id,t.quantity-1),children:"-"}),e.jsx("input",{type:"number",value:t.quantity,onChange:n=>l(t.id,n.target.value),className:"form-control"}),e.jsx("button",{className:" btn btn-success input-group-text",onClick:()=>l(t.id,t.quantity+1),children:"+"})]})}),e.jsx("td",{style:i,children:t.stock}),e.jsx("td",{style:i,children:e.jsx("button",{className:"btn btn-soft-danger",onClick:n=>u(n),children:e.jsx("i",{className:"fa fa-trash"})})})]},t.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"text-center",children:["Aucun produit n'est pas ajouté"," "]})});return e.jsxs("div",{className:"card position-absolute",style:{inset:".3rem"},children:[e.jsx("div",{className:"card-body position-relative overflow-y-auto scrollbar",children:e.jsx("div",{className:"col-12 h-100 ",children:e.jsxs("table",{className:"table table-fixed table-striped table-hover table-bordered rounded-top overflow-hidden",id:"products-table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary",children:[e.jsx("th",{className:"text-white",children:"Produit"}),e.jsx("th",{className:"text-white",children:"Quantité"}),e.jsx("th",{className:"text-white",children:"Quantité actuelle"}),e.jsx("th",{className:"text-white",children:"Action"})]})}),e.jsx("tbody",{children:d})]})})}),e.jsx("div",{className:"bg-white rounded-bottom p-3 border-light px-4",style:{borderTop:"2px dashed #eee"},children:e.jsxs("div",{className:"row mt-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("button",{className:"btn btn-danger py-3 mx-1 w-100",onClick:()=>{c([]),h(!1)},children:[e.jsx("i",{className:"fa fa-times-circle me-2 h3 mb-0"}),e.jsx("span",{className:"h4 mb-0",children:"Annuler"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("button",{onClick:()=>x(),className:"btn btn-success py-3 mx-1 w-100",children:[e.jsx("i",{className:"fa fa-paper-plane me-2 h3 mb-0"}),e.jsx("span",{className:"h4 mb-0",children:"Demander"})]})})]})})]})},_=({setAddDemande:a})=>{const[c,x]=o.useState(""),[h,i]=o.useState(""),[l,u]=o.useState([]),d=()=>{x("")},t=s=>{s.target.setAttribute("disabled","true"),f.get("articles",{params:{reference:c}}).then(r=>{n(r),s.target.removeAttribute("disabled")}).catch(r=>{toastr.error("Une erreur est survenue"),s.target.removeAttribute("disabled")})},n=s=>{if(s.data.length===1){let r=s.data[0];if(r.quantity=1,r.position=l.length+1,r.reduction=0,l.some(b=>b.id==r.id)){let b=l.map(j=>j.id==r.id?{...j,quantity:j.quantity+1}:j);u(b)}else u([...l,r]);toastr.success("Article ajouté")}else s.data.length>1?toastr.warning("Plusieurs articles trouvés"):toastr.warning("Aucun article trouvé");d()},m=()=>{if(l.length<=0)return toastr.warning("Veuillez d'abord ajouter au moins une ligne"),null;if(h==null||h=="")return toastr.warning("Veuillez sélectionner un magasin de sortie"),null;f.post("demande-transfert",{lignes:l,magasin_sortie:h}).then(s=>{toastr.success(s.data),a(!1)}).catch(s=>{if(s.response.status==422){let r=s.response.data.errors,b="";for(let j in r)b+=`<p class="text-danger">${r[j][0]}</p>`;Swal.fire({icon:"warning",title:"Attention !",html:b,confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})}else Swal.fire({icon:"error",title:"Erreur !",text:"Vuillez ressayer plus tard",confirmButtonText:"Ok !",buttonsStyling:!1,customClass:{confirmButton:"btn btn-lg btn-soft-danger mx-2"}})})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-7",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-5",children:e.jsxs("div",{className:"input-group flex-nowrap",children:[e.jsx("div",{className:"w-100",children:e.jsx(v,{classNames:{control:()=>"border-light shadow-none",option:s=>s.isFocused?"bg-primary text-white":s.isSelected?"bg-soft-primary text-white":s.isDisabled?"bg-soft-light text-muted":"",singleValue:s=>{s.isFocused}},placeholder:"Magasin de sortie",options:__magasins,value:h,onChange:s=>i(s)})}),e.jsx("button",{"data-bs-toggle":"modal","data-bs-target":"#client-modal",className:"input-group-text btn btn-light",children:"+"})]})}),e.jsx("div",{className:"col-7",children:e.jsx(g,{searchValue:c,setSearchValue:x,validateSearch:t,populateData:n})})]})})})}),e.jsx("div",{className:"col-7 d-flex flex-column",style:{height:"calc(100vh - 16rem)"},children:e.jsx(E,{items:l,setItems:u,sendDemande:m,setAddDemande:a})}),e.jsx("div",{className:"col-5",children:e.jsx(w,{setSearchValue:x,validateSearch:t,clearSearch:d,searchValue:c})})]})};function C(){const[a,c]=o.useState(16),[x,h]=o.useState(!1),[i,l]=o.useState(!1),[u,d]=o.useState(!1),[t,n]=o.useState(!1),[m,s]=o.useState(!1),r=()=>{h(!x),x?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen&&document.documentElement.mozRequestFullScreen()},b=()=>e.jsx("div",{className:"cover-spin",style:{height:"100vh",width:"100vw",zIndex:999999,top:0,left:0,position:"fixed",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0,0,0,0.5)"},dangerouslySetInnerHTML:{__html:__spinner_element_lg}});return o.useEffect(()=>{document.documentElement.style.fontSize=a+"px"},[a]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row m-0",id:"main-row",children:[i?b():"",e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card bg-transparent shadow-none pb-0",children:e.jsxs("div",{className:"card-body pb-1 px-0",children:[e.jsxs("div",{className:"float-end",children:[e.jsx("button",{onClick:()=>c(a+1),className:"btn btn-soft-info mx-1 shadow-sm",children:e.jsx("i",{className:"fa fa-search-plus"})}),e.jsx("button",{onClick:()=>c(a-1),className:"btn btn-soft-purple mx-1 shadow-sm",children:e.jsx("i",{className:"fa fa-search-minus"})}),e.jsx("button",{className:"btn btn-soft-warning mx-1 shadow-sm  ",onClick:()=>r(),children:e.jsx("i",{className:x?"fa fa-compress":"fa fa-expand"})})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx("a",{href:"/point-de-vente",className:"text-primary h3 me-3",children:e.jsx("i",{className:"fa fa-arrow-left"})}),e.jsxs("h3",{children:["Demandes",e.jsxs("span",{className:"h6 ms-1",children:["(",__magasin_ref,")"]})]})]})]})})}),m?e.jsx(_,{setAddDemande:s}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-6 d-flex flex-column",style:{height:"calc(100vh - 10rem)"},children:e.jsxs("div",{className:"card position-absolute",style:{inset:".3rem"},children:[e.jsxs("div",{className:"card-body pb-0 flex-grow-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"m-0",children:"Mes demandes"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-rounded btn-soft-warning me-2",onClick:()=>d(!u),children:e.jsx("i",{className:"fa fa-sync"})}),e.jsx("button",{className:"btn btn-soft-success btn-rounded",onClick:()=>s(!0),children:e.jsx("i",{className:"fa fa-plus"})})]})]}),e.jsx("hr",{})]}),e.jsx("div",{className:"card-body overflow-y-auto scrollbar",children:e.jsx(S,{refresh:u})})]})}),e.jsx("div",{className:"col-6 d-flex flex-column",style:{height:"calc(100vh - 10rem)"},children:e.jsxs("div",{className:"card position-absolute",style:{inset:".3rem"},children:[e.jsxs("div",{className:"card-body pb-0 flex-grow-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"m-0",children:"Demandes externe"}),e.jsx("button",{className:"btn btn-rounded btn-soft-warning",onClick:()=>n(!t),children:e.jsx("i",{className:"fa fa-sync"})})]}),e.jsx("hr",{})]}),e.jsx("div",{className:"card-body overflow-y-auto scrollbar",children:e.jsx(D,{refresh:t})})]})})]})]})})}f.defaults.baseURL=__api_url;f.defaults.headers.common["X-CSRF-TOKEN"]=sessionStorage.getItem("csrf");f.defaults.withCredentials=!0;f.defaults.withXSRFToken=!0;f.defaults.headers.Authorization="Bearer "+sessionStorage.getItem("access_token");p.createRoot(document.getElementById("root")).render(e.jsx(N.StrictMode,{children:e.jsx(C,{})}));
